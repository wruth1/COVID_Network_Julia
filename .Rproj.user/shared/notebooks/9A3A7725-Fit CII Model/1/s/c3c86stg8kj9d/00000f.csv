"0","# Number of fitted parameters in each model"
"0","np0 <- 1"
"0","np1 <- 17"
"0","np2 <- 129"
"0","np3 <- 577"
"0","np4 <- 2257"
"0",""
"0","n_pars <- c(np0, np1, np2, np3, np4)"
"0",""
"0","all_dev_imp_diffs <- array(0, "
"0","  dim = c(length(all_thresholds), length(n_pars)-1))"
"0","rownames(all_dev_imp_diffs) = all_thresholds"
"0","colnames(all_dev_imp_diffs) = c(""Main"", paste0(2:4, ""-Way""))"
"0","all_rel_dev_imp_diffs <- all_dev_imp_diffs"
"0",""
"0",""
"0","all_dev_imps <- array(0, "
"0","  dim = c(length(all_thresholds), length(n_pars)))"
"0","rownames(all_dev_imps) = all_thresholds"
"0","colnames(all_dev_imps) = c(""Null"", ""Main"", paste0(2:4, ""-Way""))"
"0","all_rel_dev_imps <- all_dev_imps"
"0",""
"0",""
"0",""
"0","## Fit models"
"0","for (i in 1:length(all_thresholds)) {"
"0","  print(paste(i, ""of"", length(all_thresholds)))"
"0","  thresh = as.character(all_thresholds[i])"
"0","  "
"0","  this_data <- filter(data_logit, threshold == thresh) %>%"
"0","    select(-threshold)"
"0","  this_weights <- rep(thresh2size(thresh), times = nrow(this_data))"
"0","  "
"0","  # Fit models with increasing numbers of interactions"
"0","  fit0 <- glm(prop ~ 1, this_data, family = quasibinomial(),"
"0","    weights = this_weights)"
"0","  fit1 <- glm(prop ~ ., this_data, family = quasibinomial(),"
"0","    weights = this_weights)"
"0","  fit2 <- glm(prop ~ . ^ 2,"
"0","    this_data,"
"0","    family = quasibinomial(),"
"0","    weights = this_weights)"
"0","  fit3 <- glm(prop ~ . ^ 3,"
"0","    this_data,"
"0","    family = quasibinomial(),"
"0","    weights = this_weights)"
"0","  fit4 <- glm(prop ~ . ^ 4,"
"0","    this_data,"
"0","    family = quasibinomial(),"
"0","    weights = this_weights)"
"0","  "
"0","  models <- list(fit0, fit1, fit2, fit3, fit4)"
"0","  # models <- list(fit0, fit1, fit4)"
"0","  # n_pars <- c(np0, np1, np4)"
"0","  "
"0","  # Get deviance improvements"
"0","  model_devs <- map_dbl(models, ~ .$deviance)"
"0","  dev_imps <- map_dbl(model_devs, ~ model_devs[1] - .)"
"0","  "
"0","  dev_imp_diffs <- diff(dev_imps)"
"0","  rel_dev_imp_diffs <- dev_imp_diffs / max(dev_imp_diffs)"
"0","  "
"0","  all_dev_imp_diffs[i,] <- dev_imp_diffs"
"0","  all_rel_dev_imp_diffs[i,] <- rel_dev_imp_diffs"
"0","  "
"0","  # par_diffs <- diff(n_pars)"
"0","  "
"0","  dev_imp_per_par <- dev_imps / n_pars"
"0","  rel_imp_per_par <- dev_imp_per_par / max(dev_imp_per_par)"
"0","  "
"0","  all_dev_imps[i, ] <-  dev_imp_per_par"
"0","  all_rel_dev_imps[i, ] <- rel_imp_per_par"
"0","}"
"1","[1]"
"1"," ""1 of 4"""
"1","
"
